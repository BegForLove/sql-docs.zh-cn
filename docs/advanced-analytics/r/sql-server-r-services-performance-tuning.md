---
title: "SQL Server R Services 性能优化 | Microsoft Docs"
ms.custom: 
ms.date: 07/12/2017
ms.prod: sql-server-2016
ms.reviewer: 
ms.suite: 
ms.technology:
- r-services
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: cf6f3b7d-f9f9-4e45-b0d1-07850b53e0c5
caps.latest.revision: 20
author: jeannt
ms.author: jeannt
manager: jhubbard
ms.translationtype: MT
ms.sourcegitcommit: 876522142756bca05416a1afff3cf10467f4c7f1
ms.openlocfilehash: 161f42e2559725b41df605c1e1c2ca12acae9c97
ms.contentlocale: zh-cn
ms.lasthandoff: 09/01/2017

---
# <a name="performance-tuning-for-r-in-sql-server"></a>SQL Server 中的 R 性能调整

本文是一系列描述基于两个案例研究的 R 服务的性能优化的四个文章中的第一个：

- 通过验证 R 解决方案的性能配置文件产品开发团队执行的性能测试

- 由 Microsoft 数据科学团队通常请求的客户特定的机器学习方案的性能优化。

这一系列旨在提供有关性能优化技术最适用于 SQL Server 中运行 R 作业的类型的指导。

+ 优化数据科学任务时，此 （第一个） 主题提供体系结构和一些常见问题的方法的概述。
+ 第二篇文章介绍了特定的硬件和 SQL Server 优化。
+ 第三个本文介绍了中的操作化 R 代码和资源优化。
+ 第四个指南介绍了中的详细信息，并报告结果和可以给予结论的测试方法。

**适用于：** SQL Server 2016 R Services、 SQL Server 自 2017 年 1 机器学习服务

## <a name="performance-goals-and-targeted-scenarios"></a>性能目标和的目标的方案

SQL server 以支持 R 脚本执行的 SQL Server 2016 中引入了 R Services 功能。 当你使用此功能时，R 运行时从数据库引擎中，一个单独进程中起作用，但使用数据库引擎时，使用服务器资源和服务进行交互以及 SQL Server，如受信任的快速启动板安全地交换数据。

在 SQL Server 2017 宣布支持已运行相同的体系结构，使用其他语言遵循在将来的 Python 脚本。

支持的版本和语言的数量增长，是可能性的非常重要的数据库管理员和数据库架构师的注意由于机学习作业的资源争用，并且它们还可以配置服务器以支持新的工作负荷。 尽管保持接近数据分析消除了不安全的数据移动开销，但它也会移动关闭便携式计算机的数据科学家和回服务器承载数据分析工作负荷。

机器学习的性能优化清楚地不是一种通用型的做法。 以下常见任务可能具有非常不同的性能配置文件：

- 定型任务： 创建和定型与定型神经网络回归模型
- 使用 T-SQL 的提取特征与使用 R 的特征工程
- 上的单个行或小的批处理，与批量评分使用表格输入评分
- 运行 R 的计分方法与将模型部署到生产 SQL Server 上的存储过程中
- 修改 R 代码来尽量减少数据传输或删除代价高昂的数据转换
- 启用自动测试和重新训练的模型

因为的优化技术的选择取决于哪些任务为关键应用程序或用例，案例研究介绍常规性能提示，以及有关如何针对特定方案中，适用于批处理计分优化进行优化的指导。

+ **SQL Server 中的单个优化选项**

    在第一个性能案例研究，在使用单一类型的模型为单个数据集上运行了多个测试。 RevoscaleR rxLinMod 算法用于生成模型和创建评分，但代码以及基础数据表系统地已更改来测试每个更改的影响。

    例如，一个测试运行中的 R 代码已更改，以便可以使用与预计算功能，然后从表中加载功能的转换函数的特征工程之间进行比较。 在另一个测试运行中，模型训练性能已在具有各种类型的压缩或新的索引类型的表中使用与数据的标准索引的表之间进行比较。

+ **针对特定的大容量评分方案优化**

    机器学习任务的第二个案例研究中涉及处理许多恢复提交多个位置，并为每个作业位置查找最佳的预发布版本。 机器学习模型本身阐述为二元分类问题： 它使用的恢复和作业的说明，作为输入，并生成恢复作业的每个对的概率。 由于目标是可找到最佳匹配项，使用用户定义的概率阈值以进一步筛选和获取只需很好的匹配项。

    对于此解决方案，主要目的是在评分过程实现低延迟。 但是，此任务，甚至在评分过程中，计算开销很大，因为每个新的作业必须与数以百万计的合理的时间范围内的简历相匹配。 此外，功能工程步骤生成每个恢复或作业，超过 2000年功能，并显著的性能瓶颈。

我们建议你查看所有结果从第一个的案例研究，以确定哪些技术适用于你的解决方案，并权衡其潜在影响。

然后，查看评分的优化案例研究，了解作者如何应用不同的技术以及优化服务器来支持特定的工作负荷的结果。

## <a name="performance-optimization-process"></a>性能优化过程

配置和优化性能的需要创建可靠的基础，依据到适合特定的工作负荷的层优化：

- 选择适当的服务器到主机分析。 通常情况下，reporting 辅助、 数据仓库或已用于其他报告或分析的其他服务器是首选。 但是，在混合事务分析处理 (HTAP) 解决方案中，操作数据可作为 R 的输入以快速获得评分。

- 配置 SQL Server 实例以平衡数据库引擎操作和 R 或 Python 脚本在适当的级别执行。 这可能包括更改内存和 CPU 使用情况、 NUMA 和处理器关联设置，并且创建资源组的 SQL Server 默认值。

- 优化支持高效使用的外部脚本的服务器计算机。 这可以包括增加用于外部脚本执行，启用包管理的帐户的数量和分配用户相关的安全角色。

- 将特定的优化应用到数据存储和 SQL Server，包括索引和统计信息策略、 查询设计和查询优化和用于机器学习的表的设计中的传输。 您还可以分析数据源和数据传输方法，或修改 ETL 过程，以便优化提取特征。

- 优化分析的模型，以避免导致效率较低。 可能的优化的作用域取决于的 R 代码的包和你使用的数据的复杂性。 关键任务包括消除代价高昂的数据转换或数据准备工作或功能工程将任务卸载从 R 或 Python 到 ETL 过程或 SQL。 你可能重构脚本、 消除串联包安装，将 R 代码划分为训练、 评分，和评估，单独的过程或简化代码，以作为存储过程更有效地工作。

## <a name="articles-in-this-series"></a>本系列文章

+ [SQL Server 的硬件中的 R 性能调整](..\r\sql-server-configuration-r-services.md)

    提供配置硬件的指南， [!INCLUDE [ssNoVersion_md](..\..\includes\ssnoversion-md.md) ] ，以及用于配置要更好地支持外部脚本的 SQL Server 实例安装。 它很适合用于**数据库管理员**。

+ [SQL Server 的代码和数据中的 R 性能调整优化](..\r\r-and-data-optimization-r-services.md)

    提供有关如何优化外部的脚本，以避免出现已知的问题的特定提示。 它是到最有用**数据科学家**。

    [!NOTE]
    > 此部分中大部分通常适用于 R，而某些信息是信息的特定于 RevoScaleR 分析函数。 详细的性能指南也无法供**revoscalepy**和其他支持 Python 库。

+ [SQL Server 的方法和结果中的 R 性能调整](..\r\performance-case-study-r-services.md)

    总结了哪些数据是使用两个用例研究、 如何性能进行了测试，和优化如何影响结果。
